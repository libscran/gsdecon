<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>gsdecon: C++ port of the GSDecon algorithm</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">gsdecon
   </div>
   <div id="projectbrief">C++ port of the GSDecon algorithm</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">C++ port of the GSDecon algorithm </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2github_2workspace_2README"></a> </p>
<h1><a class="anchor" id="autotoc_md1"></a>
Introduction</h1>
<p>This repository implements a C++ port of the <a href="https://github.com/JasonHackney/GSDecon"><b>GSDecon</b></a> algorithm for computing gene set scores from a single-cell expression matrix. The assumption is that there is one main axis of variation for the genes in the set, typically corresponding to some coordinated biological pathway. To capture this variation, we compute the first principal component (PC) in the submatrix consisting of the genes of interest. We then construct a rank-1 approximation of the submatrix and define the gene set score for each cell from the column means of the approximated matrix. In effect, each cell's score is the average expression of each gene in the set after removing noise and other secondary factors of variation from the expression submatrix - this corresponds to the expression of an "eigengene" in the context of the original <b>GSDecon</b>.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Quick start</h1>
<p>Given a <a href="https://github.com/tatami-inc/tatami"><code>tatami::Matrix</code></a> corresponding to the submatrix of genes in the set, the <code><a class="el" href="namespacegsdecon.html#a53b57233af73d2b0842bc1898c0a4e02">gsdecon::compute()</a></code> function will compute the scores for each cell:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="gsdecon_8hpp.html">gsdecon/gsdecon.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// This should already be subsetted to the features of interest:</span></div>
<div class="line"><span class="keyword">const</span> <a class="code hl_classRef" href="https://tatami-inc.github.io/tatami/classtatami_1_1Matrix.html">tatami::Matrix&lt;double, int&gt;</a>&amp; mat = some_data_source();</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structgsdecon_1_1Options.html">gsdecon::Options</a> opt;</div>
<div class="line"><span class="keyword">auto</span> res = <a class="code hl_function" href="namespacegsdecon.html#a53b57233af73d2b0842bc1898c0a4e02">gsdecon::compute</a>(mat, opt);</div>
<div class="line">res.scores; <span class="comment">// one per cell.</span></div>
<div class="line">res.weights; <span class="comment">// one per gene in the set.</span></div>
<div class="ttc" id="aclasstatami_1_1Matrix_html"><div class="ttname"><a href="https://tatami-inc.github.io/tatami/classtatami_1_1Matrix.html">tatami::Matrix</a></div></div>
<div class="ttc" id="agsdecon_8hpp_html"><div class="ttname"><a href="gsdecon_8hpp.html">gsdecon.hpp</a></div><div class="ttdoc">Umbrella header for GSDecon.</div></div>
<div class="ttc" id="anamespacegsdecon_html_a53b57233af73d2b0842bc1898c0a4e02"><div class="ttname"><a href="namespacegsdecon.html#a53b57233af73d2b0842bc1898c0a4e02">gsdecon::compute</a></div><div class="ttdeci">void compute(const tatami::Matrix&lt; Value_, Index_ &gt; &amp;matrix, const Options &amp;options, const Buffers&lt; Float_ &gt; &amp;output)</div><div class="ttdef"><b>Definition</b> compute.hpp:38</div></div>
<div class="ttc" id="astructgsdecon_1_1Options_html"><div class="ttname"><a href="structgsdecon_1_1Options.html">gsdecon::Options</a></div><div class="ttdoc">Options for compute().</div><div class="ttdef"><b>Definition</b> Options.hpp:17</div></div>
</div><!-- fragment --><p>The per-gene weights are set to the absolute values of the rotation matrix corresponding to the first PC. They can be used to obtain some diagnostics about the genes with the greatest contribution to the rank-1 approximation.</p>
<p>In the case of multiple blocks (e.g., samples, batches), we regress out the block effects and compute the first PC from the residuals. This ensures that the major axis of variation is not driven by uninteresting differences between blocks. However, this does not actually remove the block effects themselves, so any further analysis steps should still be block-aware.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structgsdecon_1_1Options.html">gsdecon::Options</a> opt;</div>
<div class="line">std::vector&lt;double&gt; block_ids(mat.ncols()); <span class="comment">// fill with block assignments.</span></div>
<div class="line"><span class="keyword">auto</span> bres = <a class="code hl_function" href="namespacegsdecon.html#a8dee2458dda74541956c0d297afce186">gsdecon::compute_blocked</a>(mat, block_ids.data(), opt);</div>
<div class="ttc" id="anamespacegsdecon_html_a8dee2458dda74541956c0d297afce186"><div class="ttname"><a href="namespacegsdecon.html#a8dee2458dda74541956c0d297afce186">gsdecon::compute_blocked</a></div><div class="ttdeci">void compute_blocked(const tatami::Matrix&lt; Value_, Index_ &gt; &amp;matrix, const Block_ *block, const Options &amp;options, const Buffers&lt; Float_ &gt; &amp;output)</div><div class="ttdef"><b>Definition</b> blocked.hpp:45</div></div>
</div><!-- fragment --><p>Check out the <a href="https://libscran.github.io/gsdecon">reference documentation</a> for more details.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Building projects</h1>
<h2><a class="anchor" id="autotoc_md4"></a>
CMake with &lt;tt&gt;FetchContent&lt;/tt&gt;</h2>
<p>If you're using CMake, you just need to add something like this to your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  gsdecon</div>
<div class="line">  GIT_REPOSITORY https://github.com/libscran/gsdecon</div>
<div class="line">  GIT_TAG master # or any version of interest</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(gsdecon)</div>
</div><!-- fragment --><p>Then you can link to <b>gsdecon</b> to make the headers available during compilation:</p>
<div class="fragment"><div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe libscran::gsdecon)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE libscran::gsdecon)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
CMake with &lt;tt&gt;find_package()&lt;/tt&gt;</h2>
<div class="fragment"><div class="line">find_package(libscran_gsdecon CONFIG REQUIRED)</div>
<div class="line">target_link_libraries(mylib INTERFACE libscran::gsdecon)</div>
</div><!-- fragment --><p>To install the library, use:</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake .. -DGSDECON_TESTS=OFF</div>
<div class="line">cmake --build . --target install</div>
</div><!-- fragment --><p>By default, this will use <code>FetchContent</code> to fetch all external dependencies. If you want to install them manually, use <code>-DGSDECON_FETCH_EXTERN=OFF</code>. See the tags in <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a> to find compatible versions of each dependency.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Manual</h2>
<p>If you're not using CMake, the simple approach is to just copy the files in <code>include/</code> - either directly or with Git submodules - and include their path during compilation with, e.g., GCC's <code>-I</code>. This requires the external dependencies listed in <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a>, which also need to be made available during compilation. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
